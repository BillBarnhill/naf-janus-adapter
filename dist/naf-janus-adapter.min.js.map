{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/debug/src/browser.js","webpack:///./node_modules/ms/index.js","webpack:///./node_modules/debug/src/debug.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/minijanus/minijanus.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","process","load","storage","debug","e","env","DEBUG","log","console","Function","apply","arguments","formatArgs","args","useColors","this","namespace","humanize","diff","color","splice","index","lastC","replace","match","save","namespaces","removeItem","window","type","navigator","userAgent","toLowerCase","document","documentElement","style","WebkitAppearance","firebug","exception","table","parseInt","RegExp","$1","chrome","local","localStorage","localstorage","colors","formatters","j","v","JSON","stringify","err","message","enable","h","y","plural","ms","Math","floor","ceil","val","options","length","str","String","exec","parseFloat","parse","isNaN","long","fmtLong","round","fmtShort","Error","createDebug","prevTime","enabled","self","curr","Date","prev","Array","coerce","unshift","format","formatter","hash","charCodeAt","abs","selectColor","destroy","init","instances","push","indexOf","stack","disable","names","skips","split","len","substr","instance","test","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","run","marker","runClearTimeout","Item","array","noop","nextTick","title","browser","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","JanusPluginHandle","session","id","undefined","JanusSession","output","nextTxId","txns","eventHandlers","assign","verbose","timeoutMs","keepaliveMs","attach","plugin","payload","force-bundle","force-rtcp-mux","send","then","resp","data","detach","ev","callback","signal","sender","handle_id","sendMessage","body","sendJsep","jsep","sendTrickle","candidate","dispose","txId","_killKeepalive","txn","reject","isError","janus","handlers","receive","_logIncoming","session_id","warn","responseType","transaction","resolve","toString","Promise","_transmit","_logOutgoing","_resetKeepalive","kind","_sendKeepalive","keepaliveTimeout","catch","error","mj","debounce","fn","slice","_","isH264VideoSupported","createElement","canPlayType","PEER_CONNECTION_CONFIG","iceServers","urls","WS_NORMAL_CLOSURE","JanusAdapter","constructor","room","userId","random","Number","MAX_SAFE_INTEGER","serverUrl","webRtcOptions","ws","initialReconnectionDelay","reconnectionDelay","reconnectionTimeout","maxReconnectionAttempts","reconnectionAttempts","publisher","occupants","mediaStreams","localMediaStream","pendingMediaRequests","Map","frozenUpdates","timeOffsets","serverTimeRequests","avgTimeOffset","onWebsocketOpen","onWebsocketClose","onWebsocketMessage","onDataChannelMessage","setServerUrl","url","setApp","app","setRoom","roomName","setWebRtcOptions","setServerConnectListeners","successListener","failureListener","connectSuccess","connectFailure","setRoomOccupantListener","occupantListener","onOccupantsChanged","setDataChannelListeners","openListener","closedListener","messageListener","onOccupantConnected","onOccupantDisconnected","onOccupantMessage","setReconnectionListeners","reconnectingListener","reconnectedListener","reconnectionErrorListener","onReconnecting","onReconnected","onReconnectionError","connect","websocketConnection","onOpen","WebSocket","onError","addEventListener","removeEventListener","all","updateTimeOffset","disconnect","removeAllOccupants","conn","close","isDisconnected","_this","_asyncToGenerator","createPublisher","initialOccupants","map","addOccupant","event","code","reconnect","occupantId","_this2","subscriber","createSubscriber","setMediaStream","mediaStream","getOwnPropertyNames","removeOccupant","has","msg","audio","video","delete","associate","handle","offer","createOffer","setLocalDescription","remote","setRemoteDescription","sdp","configureSubscriberSdp","answer","createAnswer","a","_this3","RTCPeerConnection","reliableChannel","createDataChannel","ordered","unreliableChannel","maxRetransmits","getTracks","forEach","track","addTrack","plugindata","room_id","user_id","dispatchEvent","CustomEvent","detail","clientId","by","sendJoin","notifications","success","response","users","originalSdp","_this4","media","MediaStream","getReceivers","receiver","subscribe","toggleFreeze","frozen","unfreeze","freeze","flushPendingUpdates","networkId","owner","dataType","clear","storeMessage","storedMessage","lastOwnerTime","set","components","shouldStartConnectionTo","client","startStreamConnection","closeStreamConnection","getConnectStatus","NAF","adapters","IS_CONNECTED","NOT_CONNECTED","_this5","clientSentTime","now","res","fetch","location","href","method","cache","serverReceivedTime","headers","getTime","precision","clientReceivedTime","timeOffset","reduce","acc","offset","getServerTime","getMediaStream","audioPromise","videoPromise","promise","stream","audioStream","getAudioTracks","videoStream","getVideoTracks","setLocalMediaStream","existingSenders","getSenders","newSenders","find","replaceTrack","removeTrack","includes","enableMicrophone","sendData","sendDataGuaranteed","broadcastData","broadcastDataGuaranteed","block","whom","unblock","register"],"mappings":"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","file":"naf-janus-adapter.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = 'undefined' != typeof chrome\n               && 'undefined' != typeof chrome.storage\n                  ? chrome.storage.local\n                  : localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  '#0000CC', '#0000FF', '#0033CC', '#0033FF', '#0066CC', '#0066FF', '#0099CC',\n  '#0099FF', '#00CC00', '#00CC33', '#00CC66', '#00CC99', '#00CCCC', '#00CCFF',\n  '#3300CC', '#3300FF', '#3333CC', '#3333FF', '#3366CC', '#3366FF', '#3399CC',\n  '#3399FF', '#33CC00', '#33CC33', '#33CC66', '#33CC99', '#33CCCC', '#33CCFF',\n  '#6600CC', '#6600FF', '#6633CC', '#6633FF', '#66CC00', '#66CC33', '#9900CC',\n  '#9900FF', '#9933CC', '#9933FF', '#99CC00', '#99CC33', '#CC0000', '#CC0033',\n  '#CC0066', '#CC0099', '#CC00CC', '#CC00FF', '#CC3300', '#CC3333', '#CC3366',\n  '#CC3399', '#CC33CC', '#CC33FF', '#CC6600', '#CC6633', '#CC9900', '#CC9933',\n  '#CCCC00', '#CCCC33', '#FF0000', '#FF0033', '#FF0066', '#FF0099', '#FF00CC',\n  '#FF00FF', '#FF3300', '#FF3333', '#FF3366', '#FF3399', '#FF33CC', '#FF33FF',\n  '#FF6600', '#FF6633', '#FF9900', '#FF9933', '#FFCC00', '#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // NB: In an Electron preload script, document will be defined but not fully\n  // initialized. Since we know we're in Chrome, we'll just detect this case\n  // explicitly\n  if (typeof window !== 'undefined' && window.process && window.process.type === 'renderer') {\n    return true;\n  }\n\n  // Internet Explorer and Edge do not support colors.\n  if (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n    return false;\n  }\n\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  // document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n  return (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n    // double check webkit in userAgent just in case we are in a worker\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  try {\n    return JSON.stringify(v);\n  } catch (err) {\n    return '[UnexpectedJSONParseError]: ' + err.message;\n  }\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return;\n\n  var c = 'color: ' + this.color;\n  args.splice(1, 0, c, 'color: inherit')\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-zA-Z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // this hackery is required for IE8/9, where\n  // the `console.log` function doesn't have 'apply'\n  return 'object' === typeof console\n    && console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      exports.storage.removeItem('debug');\n    } else {\n      exports.storage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = exports.storage.debug;\n  } catch(e) {}\n\n  // If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n  if (!r && typeof process !== 'undefined' && 'env' in process) {\n    r = process.env.DEBUG;\n  }\n\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n  try {\n    return window.localStorage;\n  } catch (e) {}\n}\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isNaN(val) === false) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  if (ms >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (ms >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (ms >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (ms >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  return plural(ms, d, 'day') ||\n    plural(ms, h, 'hour') ||\n    plural(ms, m, 'minute') ||\n    plural(ms, s, 'second') ||\n    ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) {\n    return;\n  }\n  if (ms < n * 1.5) {\n    return Math.floor(ms / n) + ' ' + name;\n  }\n  return Math.ceil(ms / n) + ' ' + name + 's';\n}\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = createDebug.debug = createDebug['default'] = createDebug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = require('ms');\n\n/**\n * Active `debug` instances.\n */\nexports.instances = [];\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n */\n\nexports.formatters = {};\n\n/**\n * Select a color.\n * @param {String} namespace\n * @return {Number}\n * @api private\n */\n\nfunction selectColor(namespace) {\n  var hash = 0, i;\n\n  for (i in namespace) {\n    hash  = ((hash << 5) - hash) + namespace.charCodeAt(i);\n    hash |= 0; // Convert to 32bit integer\n  }\n\n  return exports.colors[Math.abs(hash) % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction createDebug(namespace) {\n\n  var prevTime;\n\n  function debug() {\n    // disabled?\n    if (!debug.enabled) return;\n\n    var self = debug;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // turn the `arguments` into a proper Array\n    var args = new Array(arguments.length);\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %O\n      args.unshift('%O');\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-zA-Z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    // apply env-specific formatting (colors, etc.)\n    exports.formatArgs.call(self, args);\n\n    var logFn = debug.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n\n  debug.namespace = namespace;\n  debug.enabled = exports.enabled(namespace);\n  debug.useColors = exports.useColors();\n  debug.color = selectColor(namespace);\n  debug.destroy = destroy;\n\n  // env-specific initialization logic for debug instances\n  if ('function' === typeof exports.init) {\n    exports.init(debug);\n  }\n\n  exports.instances.push(debug);\n\n  return debug;\n}\n\nfunction destroy () {\n  var index = exports.instances.indexOf(this);\n  if (index !== -1) {\n    exports.instances.splice(index, 1);\n    return true;\n  } else {\n    return false;\n  }\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  exports.names = [];\n  exports.skips = [];\n\n  var i;\n  var split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n\n  for (i = 0; i < exports.instances.length; i++) {\n    var instance = exports.instances[i];\n    instance.enabled = exports.enabled(instance.namespace);\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  if (name[name.length - 1] === '*') {\n    return true;\n  }\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\n * Represents a handle to a single Janus plugin on a Janus session. Each WebRTC connection to the Janus server will be\n * associated with a single handle. Once attached to the server, this handle will be given a unique ID which should be\n * used to associate it with future signalling messages.\n *\n * See https://janus.conf.meetecho.com/docs/rest.html#handles.\n **/\nfunction JanusPluginHandle(session) {\n  this.session = session;\n  this.id = undefined;\n}\n\n/** Attaches this handle to the Janus server and sets its ID. **/\nJanusPluginHandle.prototype.attach = function(plugin) {\n  var payload = { plugin: plugin, \"force-bundle\": true, \"force-rtcp-mux\": true };\n  return this.session.send(\"attach\", payload).then(resp => {\n    this.id = resp.data.id;\n    return resp;\n  });\n};\n\n/** Detaches this handle. **/\nJanusPluginHandle.prototype.detach = function() {\n  return this.send(\"detach\");\n};\n\n/** Registers a callback to be fired upon the reception of any incoming Janus signals for this plugin handle with the\n * `janus` attribute equal to `ev`.\n **/\nJanusPluginHandle.prototype.on = function(ev, callback) {\n  return this.session.on(ev, signal => {\n    if (signal.sender == this.id) {\n      callback(signal);\n    }\n  });\n};\n\n/**\n * Sends a signal associated with this handle. Signals should be JSON-serializable objects. Returns a promise that will\n * be resolved or rejected when a response to this signal is received, or when no response is received within the\n * session timeout.\n **/\nJanusPluginHandle.prototype.send = function(type, signal) {\n  return this.session.send(type, Object.assign({ handle_id: this.id }, signal));\n};\n\n/** Sends a plugin-specific message associated with this handle. **/\nJanusPluginHandle.prototype.sendMessage = function(body) {\n  return this.send(\"message\", { body: body });\n};\n\n/** Sends a JSEP offer or answer associated with this handle. **/\nJanusPluginHandle.prototype.sendJsep = function(jsep) {\n  return this.send(\"message\", { body: {}, jsep: jsep });\n};\n\n/** Sends an ICE trickle candidate associated with this handle. **/\nJanusPluginHandle.prototype.sendTrickle = function(candidate) {\n  return this.send(\"trickle\", { candidate: candidate });\n};\n\n/**\n * Represents a Janus session -- a Janus context from within which you can open multiple handles and connections. Once\n * created, this session will be given a unique ID which should be used to associate it with future signalling messages.\n *\n * See https://janus.conf.meetecho.com/docs/rest.html#sessions.\n **/\nfunction JanusSession(output, options) {\n  this.output = output;\n  this.id = undefined;\n  this.nextTxId = 0;\n  this.txns = {};\n  this.eventHandlers = {};\n  this.options = Object.assign({\n    verbose: false,\n    timeoutMs: 10000,\n    keepaliveMs: 30000\n  }, options);\n}\n\n/** Creates this session on the Janus server and sets its ID. **/\nJanusSession.prototype.create = function() {\n  return this.send(\"create\").then(resp => {\n    this.id = resp.data.id;\n    return resp;\n  });\n};\n\n/**\n * Destroys this session. Note that upon destruction, Janus will also close the signalling transport (if applicable) and\n * any open WebRTC connections.\n **/\nJanusSession.prototype.destroy = function() {\n  return this.send(\"destroy\").then((resp) => {\n    this.dispose();\n    return resp;\n  });\n};\n\n/**\n * Disposes of this session in a way such that no further incoming signalling messages will be processed.\n * Outstanding transactions will be rejected.\n **/\nJanusSession.prototype.dispose = function() {\n  this._killKeepalive();\n  this.eventHandlers = {};\n  for (var txId in this.txns) {\n    if (this.txns.hasOwnProperty(txId)) {\n      var txn = this.txns[txId];\n      clearTimeout(txn.timeout);\n      txn.reject(new Error(\"Janus session was disposed.\"));\n      delete this.txns[txId];\n    }\n  }\n};\n\n/**\n * Whether this signal represents an error, and the associated promise (if any) should be rejected.\n * Users should override this to handle any custom plugin-specific error conventions.\n **/\nJanusSession.prototype.isError = function(signal) {\n  return signal.janus === \"error\";\n};\n\n/** Registers a callback to be fired upon the reception of any incoming Janus signals for this session with the\n * `janus` attribute equal to `ev`.\n **/\nJanusSession.prototype.on = function(ev, callback) {\n  var handlers = this.eventHandlers[ev];\n  if (handlers == null) {\n    handlers = this.eventHandlers[ev] = [];\n  }\n  handlers.push(callback);\n};\n\n/**\n * Callback for receiving JSON signalling messages pertinent to this session. If the signals are responses to previously\n * sent signals, the promises for the outgoing signals will be resolved or rejected appropriately with this signal as an\n * argument.\n *\n * External callers should call this function every time a new signal arrives on the transport; for example, in a\n * WebSocket's `message` event, or when a new datum shows up in an HTTP long-polling response.\n **/\nJanusSession.prototype.receive = function(signal) {\n  if (this.options.verbose) {\n    this._logIncoming(signal);\n  }\n  if (signal.session_id != this.id) {\n    console.warn(\"Incorrect session ID received in Janus signalling message: was \" + signal.session_id + \", expected \" + this.id + \".\");\n  }\n\n  var responseType = signal.janus;\n  var handlers = this.eventHandlers[responseType];\n  if (handlers != null) {\n    for (var i = 0; i < handlers.length; i++) {\n      handlers[i](signal);\n    }\n  }\n\n  if (signal.transaction != null) {\n    var txn = this.txns[signal.transaction];\n    if (txn == null) {\n      // this is a response to a transaction that wasn't caused via JanusSession.send, or a plugin replied twice to a\n      // single request, or the session was disposed, or something else that isn't under our purview; that's fine\n      return;\n    }\n\n    if (responseType === \"ack\" && txn.type == \"message\") {\n      // this is an ack of an asynchronously-processed plugin request, we should wait to resolve the promise until the\n      // actual response comes in\n      return;\n    }\n\n    clearTimeout(txn.timeout);\n\n    delete this.txns[signal.transaction];\n    (this.isError(signal) ? txn.reject : txn.resolve)(signal);\n  }\n};\n\n/**\n * Sends a signal associated with this session, beginning a new transaction. Returns a promise that will be resolved or\n * rejected when a response is received in the same transaction, or when no response is received within the session\n * timeout.\n **/\nJanusSession.prototype.send = function(type, signal) {\n  signal = Object.assign({ transaction: (this.nextTxId++).toString() }, signal);\n  return new Promise((resolve, reject) => {\n    var timeout = null;\n    if (this.options.timeoutMs) {\n      timeout = setTimeout(() => {\n        delete this.txns[signal.transaction];\n        reject(new Error(\"Signalling transaction with txid \" + signal.transaction + \" timed out.\"));\n      }, this.options.timeoutMs);\n    }\n    this.txns[signal.transaction] = { resolve: resolve, reject: reject, timeout: timeout, type: type };\n    this._transmit(type, signal);\n  });\n};\n\nJanusSession.prototype._transmit = function(type, signal) {\n  signal = Object.assign({ janus: type }, signal);\n\n  if (this.id != null) { // this.id is undefined in the special case when we're sending the session create message\n    signal = Object.assign({ session_id: this.id }, signal);\n  }\n\n  if (this.options.verbose) {\n    this._logOutgoing(signal);\n  }\n\n  this.output(JSON.stringify(signal));\n  this._resetKeepalive();\n};\n\nJanusSession.prototype._logOutgoing = function(signal) {\n  var kind = signal.janus;\n  if (kind === \"message\" && signal.jsep) {\n    kind = signal.jsep.type;\n  }\n  var message = \"> Outgoing Janus \" + (kind || \"signal\") + \" (#\" + signal.transaction + \"): \";\n  console.debug(\"%c\" + message, \"color: #040\", signal);\n};\n\nJanusSession.prototype._logIncoming = function(signal) {\n  var kind = signal.janus;\n  var message = signal.transaction ?\n      \"< Incoming Janus \" + (kind || \"signal\") + \" (#\" + signal.transaction + \"): \" :\n      \"< Incoming Janus \" + (kind || \"signal\") + \": \";\n  console.debug(\"%c\" + message, \"color: #004\", signal);\n};\n\nJanusSession.prototype._sendKeepalive = function() {\n  return this.send(\"keepalive\");\n};\n\nJanusSession.prototype._killKeepalive = function() {\n  clearTimeout(this.keepaliveTimeout);\n};\n\nJanusSession.prototype._resetKeepalive = function() {\n  this._killKeepalive();\n  if (this.options.keepaliveMs) {\n    this.keepaliveTimeout = setTimeout(() => {\n      this._sendKeepalive().catch(e => console.error(\"Error received from keepalive: \", e));\n    }, this.options.keepaliveMs);\n  }\n};\n\nmodule.exports = {\n  JanusPluginHandle,\n  JanusSession\n};\n","var mj = require(\"minijanus\");\nvar debug = require(\"debug\")(\"naf-janus-adapter:debug\");\nvar warn = require(\"debug\")(\"naf-janus-adapter:warn\");\nvar error = require(\"debug\")(\"naf-janus-adapter:error\");\n\nfunction debounce(fn) {\n  var curr = Promise.resolve();\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    curr = curr.then(_ => fn.apply(this, args));\n  };\n}\n\nfunction randomUint() {\n  return Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\n}\n\nconst isH264VideoSupported = (() => {\n  const video = document.createElement(\"video\");\n  return video.canPlayType('video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"') !== \"\";\n})();\n\nconst PEER_CONNECTION_CONFIG = {\n  iceServers: [{ urls: \"stun:stun1.l.google.com:19302\" }, { urls: \"stun:stun2.l.google.com:19302\" }]\n};\n\nconst WS_NORMAL_CLOSURE = 1000;\n\nclass JanusAdapter {\n  constructor() {\n    this.room = null;\n    this.userId = String(randomUint());\n\n    this.serverUrl = null;\n    this.webRtcOptions = {};\n    this.ws = null;\n    this.session = null;\n\n    // In the event the server restarts and all clients lose connection, reconnect with\n    // some random jitter added to prevent simultaneous reconnection requests.\n    this.initialReconnectionDelay = 1000 * Math.random();\n    this.reconnectionDelay = this.initialReconnectionDelay;\n    this.reconnectionTimeout = null;\n    this.maxReconnectionAttempts = 10;\n    this.reconnectionAttempts = 0;\n\n    this.publisher = null;\n    this.occupants = {};\n    this.mediaStreams = {};\n    this.localMediaStream = null;\n    this.pendingMediaRequests = new Map();\n\n    this.frozenUpdates = new Map();\n\n    this.timeOffsets = [];\n    this.serverTimeRequests = 0;\n    this.avgTimeOffset = 0;\n\n    this.onWebsocketOpen = this.onWebsocketOpen.bind(this);\n    this.onWebsocketClose = this.onWebsocketClose.bind(this);\n    this.onWebsocketMessage = this.onWebsocketMessage.bind(this);\n    this.onDataChannelMessage = this.onDataChannelMessage.bind(this);\n  }\n\n  setServerUrl(url) {\n    this.serverUrl = url;\n  }\n\n  setApp(app) {}\n\n  setRoom(roomName) {\n    this.room = roomName;\n  }\n\n  setWebRtcOptions(options) {\n    this.webRtcOptions = options;\n  }\n\n  setServerConnectListeners(successListener, failureListener) {\n    this.connectSuccess = successListener;\n    this.connectFailure = failureListener;\n  }\n\n  setRoomOccupantListener(occupantListener) {\n    this.onOccupantsChanged = occupantListener;\n  }\n\n  setDataChannelListeners(openListener, closedListener, messageListener) {\n    this.onOccupantConnected = openListener;\n    this.onOccupantDisconnected = closedListener;\n    this.onOccupantMessage = messageListener;\n  }\n\n  setReconnectionListeners(reconnectingListener, reconnectedListener, reconnectionErrorListener) {\n    // onReconnecting is called with the number of milliseconds until the next reconnection attempt\n    this.onReconnecting = reconnectingListener;\n    // onReconnected is called when the connection has been reestablished\n    this.onReconnected = reconnectedListener;\n    // onReconnectionError is called with an error when maxReconnectionAttempts has been reached\n    this.onReconnectionError = reconnectionErrorListener;\n  }\n\n  connect() {\n    debug(`connecting to ${this.serverUrl}`);\n\n    const websocketConnection = new Promise((resolve, reject) => {\n      this.ws = new WebSocket(this.serverUrl, \"janus-protocol\");\n\n      this.session = new mj.JanusSession(this.ws.send.bind(this.ws));\n\n      let onOpen;\n\n      const onError = () => {\n        reject(error);\n      };\n\n      this.ws.addEventListener(\"close\", this.onWebsocketClose);\n      this.ws.addEventListener(\"message\", this.onWebsocketMessage);\n\n      onOpen = () => {\n        this.ws.removeEventListener(\"open\", onOpen);\n        this.ws.removeEventListener(\"error\", onError);\n        this.onWebsocketOpen()\n          .then(resolve)\n          .catch(reject);\n      };\n\n      this.ws.addEventListener(\"open\", onOpen);\n    });\n\n    return Promise.all([websocketConnection, this.updateTimeOffset()]);\n  }\n\n  disconnect() {\n    debug(`disconnecting`);\n\n    clearTimeout(this.reconnectionTimeout);\n\n    this.removeAllOccupants();\n\n    if (this.publisher) {\n      // Close the publisher peer connection. Which also detaches the plugin handle.\n      this.publisher.conn.close();\n      this.publisher = null;\n    }\n\n    if (this.session) {\n      this.session.dispose();\n      this.session = null;\n    }\n\n    if (this.ws) {\n      this.ws.removeEventListener(\"open\", this.onWebsocketOpen);\n      this.ws.removeEventListener(\"close\", this.onWebsocketClose);\n      this.ws.removeEventListener(\"message\", this.onWebsocketMessage);\n      this.ws.close();\n      this.ws = null;\n    }\n  }\n\n  isDisconnected() {\n    return this.ws === null;\n  }\n\n  async onWebsocketOpen() {\n    // Create the Janus Session\n    await this.session.create();\n\n    // Attach the SFU Plugin and create a RTCPeerConnection for the publisher.\n    // The publisher sends audio and opens two bidirectional data channels.\n    // One reliable datachannel and one unreliable.\n    this.publisher = await this.createPublisher();\n\n    // Call the naf connectSuccess callback before we start receiving WebRTC messages.\n    this.connectSuccess(this.userId);\n\n    // Add all of the initial occupants.\n    await Promise.all(this.publisher.initialOccupants.map(this.addOccupant.bind(this)));\n  }\n\n  onWebsocketClose(event) {\n    // The connection was closed successfully. Don't try to reconnect.\n    if (event.code === WS_NORMAL_CLOSURE) {\n      return;\n    }\n\n    if (this.onReconnecting) {\n      this.onReconnecting(this.reconnectionDelay);\n    }\n\n    this.reconnectionTimeout = setTimeout(() => this.reconnect(), this.reconnectionDelay);\n  }\n\n  reconnect() {\n    // Dispose of all networked entities and other resources tied to the session.\n    this.disconnect();\n\n    this.connect()\n      .then(() => {\n        this.reconnectionDelay = this.initialReconnectionDelay;\n        this.reconnectionAttempts = 0;\n\n        if (this.onReconnected) {\n          this.onReconnected();\n        }\n      })\n      .catch(error => {\n        this.reconnectionDelay += 1000;\n        this.reconnectionAttempts++;\n\n        if (this.reconnectionAttempts > this.maxReconnectionAttempts && this.onReconnectionError) {\n          return this.onReconnectionError(\n            new Error(\"Connection could not be reestablished, exceeded maximum number of reconnection attempts.\")\n          );\n        }\n\n        if (this.onReconnecting) {\n          this.onReconnecting(this.reconnectionDelay);\n        }\n\n        this.reconnectionTimeout = setTimeout(() => this.reconnect(), this.reconnectionDelay);\n      });\n  }\n\n  onWebsocketMessage(event) {\n    this.session.receive(JSON.parse(event.data));\n  }\n\n  async addOccupant(occupantId) {\n    var subscriber = await this.createSubscriber(occupantId);\n\n    this.occupants[occupantId] = subscriber;\n\n    this.setMediaStream(occupantId, subscriber.mediaStream);\n\n    // Call the Networked AFrame callbacks for the new occupant.\n    this.onOccupantConnected(occupantId);\n    this.onOccupantsChanged(this.occupants);\n\n    return subscriber;\n  }\n\n  removeAllOccupants() {\n    for (const occupantId of Object.getOwnPropertyNames(this.occupants)) {\n      this.removeOccupant(occupantId);\n    }\n  }\n\n  removeOccupant(occupantId) {\n    if (this.occupants[occupantId]) {\n      // Close the subscriber peer connection. Which also detaches the plugin handle.\n      if (this.occupants[occupantId]) {\n        this.occupants[occupantId].conn.close();\n        delete this.occupants[occupantId];\n      }\n\n      if (this.mediaStreams[occupantId]) {\n        delete this.mediaStreams[occupantId];\n      }\n\n      if (this.pendingMediaRequests.has(occupantId)) {\n        const msg = \"The user disconnected before the media stream was resolved.\";\n        this.pendingMediaRequests.get(occupantId).audio.reject(msg);\n        this.pendingMediaRequests.get(occupantId).video.reject(msg);\n        this.pendingMediaRequests.delete(occupantId);\n      }\n\n      // Call the Networked AFrame callbacks for the removed occupant.\n      this.onOccupantDisconnected(occupantId);\n      this.onOccupantsChanged(this.occupants);\n    }\n  }\n\n  associate(conn, handle) {\n    conn.addEventListener(\"icecandidate\", ev => {\n      handle.sendTrickle(ev.candidate || null).catch(e => error(\"Error trickling ICE: %o\", e));\n    });\n\n    // we have to debounce these because janus gets angry if you send it a new SDP before\n    // it's finished processing an existing SDP. in actuality, it seems like this is maybe\n    // too liberal and we need to wait some amount of time after an offer before sending another,\n    // but we don't currently know any good way of detecting exactly how long :(\n    conn.addEventListener(\n      \"negotiationneeded\",\n      debounce(ev => {\n        debug(\"Sending new offer for handle: %o\", handle);\n        var offer = conn.createOffer();\n        var local = offer.then(o => conn.setLocalDescription(o));\n        var remote = offer.then(j => handle.sendJsep(j)).then(r => conn.setRemoteDescription(r.jsep));\n        return Promise.all([local, remote]).catch(e => error(\"Error negotiating offer: %o\", e));\n      })\n    );\n    handle.on(\n      \"event\",\n      debounce(ev => {\n        var jsep = ev.jsep;\n        if (jsep && jsep.type == \"offer\") {\n          debug(\"Accepting new offer for handle: %o\", handle);\n          jsep.sdp = this.configureSubscriberSdp(jsep.sdp);\n          var answer = conn.setRemoteDescription(jsep).then(_ => conn.createAnswer());\n          var local = answer.then(a => conn.setLocalDescription(a));\n          var remote = answer.then(j => handle.sendJsep(j));\n          Promise.all([local, remote]).catch(e => error(\"Error negotiating answer: %o\", e));\n        }\n      })\n    );\n  }\n\n  async createPublisher() {\n    var handle = new mj.JanusPluginHandle(this.session);\n    var conn = new RTCPeerConnection(PEER_CONNECTION_CONFIG);\n\n    debug(\"pub waiting for sfu\");\n    await handle.attach(\"janus.plugin.sfu\");\n\n    // Unreliable datachannel: sending and receiving component updates.\n    // Reliable datachannel: sending and recieving entity instantiations.\n    var reliableChannel = conn.createDataChannel(\"reliable\", { ordered: true });\n    var unreliableChannel = conn.createDataChannel(\"unreliable\", {\n      ordered: false,\n      maxRetransmits: 0\n    });\n    reliableChannel.addEventListener(\"message\", this.onDataChannelMessage);\n    unreliableChannel.addEventListener(\"message\", this.onDataChannelMessage);\n\n    this.associate(conn, handle);\n\n    debug(\"pub waiting for webrtcup\");\n    await new Promise(resolve => handle.on(\"webrtcup\", resolve));\n\n    // doing this here is sort of a hack around chrome renegotiation weirdness --\n    // if we do it prior to webrtcup, chrome on gear VR will sometimes put a\n    // renegotiation offer in flight while the first offer was still being\n    // processed by janus. we should find some more principled way to figure out\n    // when janus is done in the future.\n    if (this.localMediaStream) {\n      this.localMediaStream.getTracks().forEach(track => {\n        conn.addTrack(track, this.localMediaStream);\n      });\n    }\n\n    // Handle all of the join and leave events.\n    handle.on(\"event\", ev => {\n      var data = ev.plugindata.data;\n      if (data.event == \"join\" && data.room_id == this.room) {\n        this.addOccupant(data.user_id);\n      } else if (data.event == \"leave\" && data.room_id == this.room) {\n        this.removeOccupant(data.user_id);\n      } else if (data.event == \"blocked\") {\n        document.body.dispatchEvent(\n          new CustomEvent(\"blocked\", { detail: { clientId: data.by } })\n        );\n      } else if (data.event == \"unblocked\") {\n        document.body.dispatchEvent(\n          new CustomEvent(\"unblocked\", { detail: { clientId: data.by } })\n        );\n      }\n    });\n\n    debug(\"pub waiting for join\");\n    // Send join message to janus. Listen for join/leave messages. Automatically subscribe to all users' WebRTC data.\n    var message = await this.sendJoin(handle, {\n      notifications: true,\n      data: true\n    });\n\n    if (!message.plugindata.data.success) {\n      const err = message.plugindata.data.error;\n      console.error(err);\n      throw err;\n    }\n\n    var initialOccupants = message.plugindata.data.response.users[this.room] || [];\n\n    debug(\"publisher ready\");\n    return {\n      handle,\n      initialOccupants,\n      reliableChannel,\n      unreliableChannel,\n      conn\n    };\n  }\n\n  configureSubscriberSdp(originalSdp) {\n    if (!isH264VideoSupported) {\n      if (navigator.userAgent.indexOf(\"HeadlessChrome\") !== -1) {\n        // HeadlessChrome (e.g. puppeteer) doesn't support webrtc video streams, so we remove those lines from the SDP.\n        return originalSdp.replace(/m=video[^]*m=/, \"m=\");\n      } else {\n        return originalSdp;\n      }\n    }\n\n    // TODO: Hack to get video working on Chrome for Android. https://groups.google.com/forum/#!topic/mozilla.dev.media/Ye29vuMTpo8\n    if (navigator.userAgent.indexOf(\"Android\") === -1) {\n      return originalSdp.replace(\n        \"a=rtcp-fb:107 goog-remb\\r\\n\",\n        \"a=rtcp-fb:107 goog-remb\\r\\na=rtcp-fb:107 transport-cc\\r\\na=fmtp:107 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\\r\\n\"\n      );\n    } else {\n      return originalSdp.replace(\n        \"a=rtcp-fb:107 goog-remb\\r\\n\",\n        \"a=rtcp-fb:107 goog-remb\\r\\na=rtcp-fb:107 transport-cc\\r\\na=fmtp:107 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\\r\\n\"\n      );\n    }\n  }\n\n  async createSubscriber(occupantId) {\n    var handle = new mj.JanusPluginHandle(this.session);\n    var conn = new RTCPeerConnection(PEER_CONNECTION_CONFIG);\n\n    debug(\"sub waiting for sfu\");\n    await handle.attach(\"janus.plugin.sfu\");\n\n    this.associate(conn, handle);\n\n    debug(\"sub waiting for join\");\n    // Send join message to janus. Don't listen for join/leave messages. Subscribe to the occupant's media.\n    // Janus should send us an offer for this occupant's media in response to this.\n    const resp = await this.sendJoin(handle, { media: occupantId });\n\n    debug(\"sub waiting for webrtcup\");\n    await new Promise(resolve => handle.on(\"webrtcup\", resolve));\n\n    var mediaStream = new MediaStream();\n    var receivers = conn.getReceivers();\n    receivers.forEach(receiver => {\n      if (receiver.track) {\n        mediaStream.addTrack(receiver.track);\n      }\n    });\n    if (mediaStream.getTracks().length === 0) {\n      mediaStream = null;\n    }\n\n    debug(\"subscriber ready\");\n    return {\n      handle,\n      mediaStream,\n      conn\n    };\n  }\n\n  sendJoin(handle, subscribe) {\n    return handle.sendMessage({\n      kind: \"join\",\n      room_id: this.room,\n      user_id: this.userId,\n      subscribe\n    });\n  }\n\n  toggleFreeze() {\n    if(this.frozen) {\n      this.unfreeze();\n    } else {\n      this.freeze();\n    }\n  }\n\n  freeze() {\n    this.frozen = true;\n  }\n\n  unfreeze() {\n    this.frozen = false;\n    this.flushPendingUpdates();\n  }\n\n  flushPendingUpdates() {\n    for (const [networkId, message] of this.frozenUpdates) {\n      // ignore messages relating to users who have disconnected since freezing, their entities will have aleady been removed by NAF\n      // note that delete messages have no \"owner\" so we have to check for that as well\n      if(message.data.owner && !this.occupants[message.data.owner]) continue;\n\n      this.onOccupantMessage(null, message.dataType, message.data);\n    }\n    this.frozenUpdates.clear();\n  }\n\n  storeMessage(message) {\n    const networkId = message.data.networkId;\n    if(!this.frozenUpdates.has(networkId)) {\n      this.frozenUpdates.set(networkId, message);\n    } else {\n      const storedMessage = this.frozenUpdates.get(networkId);\n\n      // Avoid updating components if the entity data received did not come from the current owner.\n      if (message.data.lastOwnerTime < storedMessage.data.lastOwnerTime ||\n            (storedMessage.data.lastOwnerTime === message.data.lastOwnerTime && storedMessage.data.owner > message.data.owner)) {\n        return;\n      }\n\n      // Delete messages override any other messages for this entity\n      if(message.dataType === \"r\") {\n        this.frozenUpdates.set(networkId, message);\n      } else {\n        // merge in component updates\n        Object.assign(storedMessage.data.components, message.data.components);\n      }\n    }\n  }\n\n  onDataChannelMessage(event) {\n    var message = JSON.parse(event.data);\n\n    if (debug.enabled) {\n      debug(`DC in: ${event.data}`);\n    }\n\n    if(!message.dataType) return;\n\n    if(this.frozen) {\n      this.storeMessage(message);\n    } else {\n      this.onOccupantMessage(null, message.dataType, message.data);\n    }\n  }\n\n  shouldStartConnectionTo(client) {\n    return true;\n  }\n\n  startStreamConnection(client) {}\n\n  closeStreamConnection(client) {}\n\n  getConnectStatus(clientId) {\n    return this.occupants[clientId] ? NAF.adapters.IS_CONNECTED : NAF.adapters.NOT_CONNECTED;\n  }\n\n  async updateTimeOffset() {\n    if (this.isDisconnected()) return;\n\n    const clientSentTime = Date.now();\n\n    const res = await fetch(document.location.href, {\n      method: \"HEAD\",\n      cache: \"no-cache\"\n    });\n\n    const precision = 1000;\n    const serverReceivedTime = new Date(res.headers.get(\"Date\")).getTime() + precision / 2;\n    const clientReceivedTime = Date.now();\n    const serverTime = serverReceivedTime + (clientReceivedTime - clientSentTime) / 2;\n    const timeOffset = serverTime - clientReceivedTime;\n\n    this.serverTimeRequests++;\n\n    if (this.serverTimeRequests <= 10) {\n      this.timeOffsets.push(timeOffset);\n    } else {\n      this.timeOffsets[this.serverTimeRequests % 10] = timeOffset;\n    }\n\n    this.avgTimeOffset = this.timeOffsets.reduce((acc, offset) => (acc += offset), 0) / this.timeOffsets.length;\n\n    if (this.serverTimeRequests > 10) {\n      debug(`new server time offset: ${this.avgTimeOffset}ms`);\n      setTimeout(() => this.updateTimeOffset(), 5 * 60 * 1000); // Sync clock every 5 minutes.\n    } else {\n      this.updateTimeOffset();\n    }\n  }\n\n  getServerTime() {\n    return Date.now() + this.avgTimeOffset;\n  }\n\n  getMediaStream(clientId, type = \"audio\") {\n    if (this.mediaStreams[clientId]) {\n      debug(`Already had ${type} for ${clientId}`);\n      return Promise.resolve(this.mediaStreams[clientId][type]);\n    } else {\n      debug(`Waiting on ${type} for ${clientId}`);\n      if (!this.pendingMediaRequests.has(clientId)) {\n        this.pendingMediaRequests.set(clientId, {});\n\n        const audioPromise = new Promise((resolve, reject) => {\n          this.pendingMediaRequests.get(clientId).audio = { resolve, reject };\n        });\n        const videoPromise = new Promise((resolve, reject) => {\n          this.pendingMediaRequests.get(clientId).video = { resolve, reject };\n        });\n\n        this.pendingMediaRequests.get(clientId).audio.promise = audioPromise;\n        this.pendingMediaRequests.get(clientId).video.promise = videoPromise;\n      }\n      return this.pendingMediaRequests.get(clientId)[type].promise;\n    }\n  }\n\n  setMediaStream(clientId, stream) {\n    // Safari doesn't like it when you use single a mixed media stream where one of the tracks is inactive, so we\n    // split the tracks into two streams.\n    const audioStream = new MediaStream();\n    stream.getAudioTracks().forEach(track => audioStream.addTrack(track));\n    const videoStream = new MediaStream();\n    stream.getVideoTracks().forEach(track => videoStream.addTrack(track));\n\n    this.mediaStreams[clientId] = { audio: audioStream, video: videoStream };\n\n    // Resolve the promise for the user's media stream if it exists.\n    if (this.pendingMediaRequests.has(clientId)) {\n      this.pendingMediaRequests.get(clientId).audio.resolve(audioStream);\n      this.pendingMediaRequests.get(clientId).video.resolve(videoStream);\n    }\n  }\n\n  setLocalMediaStream(stream) {\n    // our job here is to make sure the connection winds up with RTP senders sending the stuff in this stream,\n    // and not the stuff that isn't in this stream. strategy is to replace existing tracks if we can, add tracks\n    // that we can't replace, and disable tracks that don't exist anymore.\n\n    // note that we don't ever remove a track from the stream -- since Janus doesn't support Unified Plan, we absolutely\n    // can't wind up with a SDP that has >1 audio or >1 video tracks, even if one of them is inactive (what you get if\n    // you remove a track from an existing stream.)\n    if (this.publisher && this.publisher.conn) {\n      var existingSenders = this.publisher.conn.getSenders();\n      var newSenders = [];\n      stream.getTracks().forEach(t => {\n        var sender = existingSenders.find(s => s.track != null && s.track.kind == t.kind);\n        if (sender != null) {\n          if (sender.replaceTrack) {\n            sender.replaceTrack(t);\n            sender.track.enabled = true;\n          } else {\n            // replaceTrack isn't implemented in Chrome, even via webrtc-adapter.\n            stream.removeTrack(sender.track);\n            stream.addTrack(t);\n            t.enabled = true;\n          }\n          newSenders.push(sender);\n        } else {\n          newSenders.push(this.publisher.conn.addTrack(t, stream));\n        }\n      });\n      existingSenders.forEach(s => {\n        if (!newSenders.includes(s)) {\n          s.track.enabled = false;\n        }\n      });\n    }\n    this.localMediaStream = stream;\n    this.setMediaStream(this.userId, stream);\n  }\n\n  enableMicrophone(enabled) {\n    if (this.publisher && this.publisher.conn) {\n      this.publisher.conn.getSenders().forEach(s => {\n        if (s.track.kind == \"audio\") {\n          s.track.enabled = enabled;\n        }\n      });\n    }\n  }\n\n  sendData(clientId, dataType, data) {\n    if (!this.publisher) {\n      return console.warn(\"sendData called without a publisher\");\n    }\n\n    this.publisher.unreliableChannel.send(JSON.stringify({ clientId, dataType, data }));\n  }\n\n  sendDataGuaranteed(clientId, dataType, data) {\n    if (!this.publisher) {\n      return console.warn(\"sendDataGuaranteed called without a publisher\");\n    }\n\n    this.publisher.reliableChannel.send(JSON.stringify({ clientId, dataType, data }));\n  }\n\n  broadcastData(dataType, data) {\n    if (!this.publisher) {\n      return console.warn(\"broadcastData called without a publisher\");\n    }\n\n    this.publisher.unreliableChannel.send(JSON.stringify({ dataType, data }));\n  }\n\n  broadcastDataGuaranteed(dataType, data) {\n    if (!this.publisher) {\n      return console.warn(\"broadcastDataGuaranteed called without a publisher\");\n    }\n\n    this.publisher.reliableChannel.send(JSON.stringify({ dataType, data }));\n  }\n\n  block(clientId){\n    return this.publisher.handle.sendMessage({ kind: \"block\", whom: clientId }).then(()=>{\n      document.body.dispatchEvent(\n        new CustomEvent(\"blocked\", { detail: { clientId: clientId } })\n      );\n    });\n  }\n\n  unblock(clientId){\n    return this.publisher.handle.sendMessage({ kind: \"unblock\", whom: clientId }).then(()=>{\n      document.body.dispatchEvent(\n        new CustomEvent(\"unblocked\", { detail: { clientId: clientId } })\n      );\n    });\n  }\n}\n\nNAF.adapters.register(\"janus\", JanusAdapter);\n\nmodule.exports = JanusAdapter;\n"],"sourceRoot":""}